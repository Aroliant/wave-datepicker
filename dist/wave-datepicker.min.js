(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].slice;!function(a,b){var c;return c=window.useAmd===!1,"function"==typeof define&&define.amd&&!c?define(["jquery"],function(c){return a.WDP=b(c)}):a.WDP=b(a.$)}(this,function(c){var d,e;return d={},d.$=c,d.template='<div class="wdp dropdown-menu">  <div class="row-fluid">    <div class="wdp-shortcuts span5"></div>    <div class="wdp-main">      <table class="table-condensed wdp-calendar">        <thead>          <tr>              <th class="wdp-prev">                <a href="javascript:void(0)" class="js-wdp-prev">◀</a>              </th>              <th colspan="5" class="wdp-month-and-year js-wdp-set-month-year"></th>              <th class="wdp-next">                <a href="javascript:void(0)" class="js-wdp-next">▶</a>              </th>          </tr>        </thead>        <tbody></tbody>      </table>      <table class="table-condensed wdp-year-calendar">      <tbody></tbody>      </table>      <table class="table-condensed wdp-month-calendar">      <tbody></tbody>      </table>    </div>  </div></div>',d.DateUtils={format:function(a,b){return moment(a).format(b)},parse:function(a,b){return moment(a,b)}},d.configure=function(a){return d.template=a.template||d.template,d.DateUtils.format=a.dateFormat||d.DateUtils.format,d.DateUtils.parse=a.dateParse||d.DateUtils.parse},d.Keys={RETURN:13,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,H:72,J:74,K:75,L:76},d.defaultOptions={hideOnSelect:!0},d.Shortcuts=function(){function b(b){this.options=b,this._updateSelected=a(this._updateSelected,this),this._onShortcutClick=a(this._onShortcutClick,this),this.selectPrev=a(this.selectPrev,this),this.selectNext=a(this.selectNext,this),this.options||(this.options=this._defaults),this.$el=d.$("<ul>"),this.$el.on("click",this._onShortcutClick),this.baseDate=this.options.baseDate}return b.prototype._defaults={Today:{days:0}},b.prototype.currSelectedIndex=-1,b.prototype.render=function(){var a,b,c,d,e,f,g,h;e=[],this.numShortcuts=0,g=this.options;for(c in g){if(d=g[c],a=[],d.attrs){h=d.attrs;for(b in h)f=h[b],a.push(""+b+'="'+f+'"')}e.push('<li><a          data-days="'+(d.days||0)+'"           data-months="'+(d.months||0)+'"          data-years="'+(d.years||0)+'"          data-shortcut-num="'+this.numShortcuts+'"          '+a.join("")+'          class="wdp-shortcut js-wdp-shortcut"           href="javascript:void(0)">'+c+"</a></li>"),this.numShortcuts++}return this.$el.html(e.join("")),this},b.prototype.resetClass=function(){return this.$el.find(".wdp-shortcut-active").removeClass("wdp-shortcut-active")},b.prototype.selectNext=function(){return this.currSelectedIndex=(this.currSelectedIndex+1)%this.numShortcuts,this._updateSelected()},b.prototype.selectPrev=function(){return this.currSelectedIndex=(this.currSelectedIndex-1)%this.numShortcuts,this.currSelectedIndex<0&&(this.currSelectedIndex=this.numShortcuts-1),this._updateSelected()},b.prototype.select=function(a){var b,c,d;return b=a.data(),d=moment(this.baseDate).clone(),c={days:b.days,months:b.months,years:b.years},d.add(c),this.resetClass(),a.addClass("wdp-shortcut-active"),d.isValid()?a.trigger("dateselect",d.toDate()):void 0},b.prototype._onShortcutClick=function(a){return this.select(d.$(a.target))},b.prototype._updateSelected=function(){var a;return this.resetClass(),a=this.$el.find(".wdp-shortcut[data-shortcut-num="+this.currSelectedIndex+"]").addClass("wdp-shortcut-active"),this.select(a)},b}(),d.activeDatepicker=null,d.datepickers=[],d.WaveDatepicker=function(){function b(b){var e,f,g,h=this;this.options=b,this._getExtraClassNamesForDate=a(this._getExtraClassNamesForDate,this),this._dateWithinRange=a(this._dateWithinRange,this),this._selectDate=a(this._selectDate,this),this._onInputKeydown=a(this._onInputKeydown,this),this._cancelEvent=a(this._cancelEvent,this),this._showMonthGrid=a(this._showMonthGrid,this),this._showYearGrid=a(this._showYearGrid,this),this._place=a(this._place,this),this._updateMonthAndYear=a(this._updateMonthAndYear,this),this._updateFromInput=a(this._updateFromInput,this),this._clearInput=a(this._clearInput,this),this.destroy=a(this.destroy,this),this.next=a(this.next,this),this.prev=a(this.prev,this),this.setDate=a(this.setDate,this),this.toggle=a(this.toggle,this),this.hide=a(this.hide,this),this.show=a(this.show,this),this.render=a(this.render,this),this.clearMaxDate=a(this.clearMaxDate,this),this.setMaxDate=a(this.setMaxDate,this),this.clearMinDate=a(this.clearMinDate,this),this.setMinDate=a(this.setMinDate,this),this.el=this.options.el,this.$el=d.$(this.el),this.$el.wrap('<span class="wdp-input-wrap"></span>'),this.$wrapper=this.$el.parent(),this.options=c.extend({},d.defaultOptions,b),this._state={},this.setOptionsFromDataAttr(),this.normalizeOptions(),null!=this.options.dateIncludeCalendarIcon&&this.$el.addClass("wdp-input-icon"),null!=this.options.dateIncludeClearIcon&&0===this.$wrapper.find(".wdp-clear-icon").length&&(this.$wrapper.append('<a href="javascript:void(0)" class="wdp-clear-icon" style="display:none">&times;</a>'),this.$clearEl=this.$wrapper.find(".wdp-clear-icon")),this._updateFromInput(null,null,{update:!this.options.allowClear}),this._initPicker(),this._initElements(),this._initEvents(),this.baseDate=this.options.baseDate||new Date,null!=b.shortcuts&&(e="object"==typeof b.shortcuts?b.shortcuts:null,this.shortcuts=new d.Shortcuts(e).render(),this.$shortcuts.append(this.shortcuts.$el),null!=(f=this.shortcuts)&&f.resetClass(),this.shortcuts.baseDate=this.baseDate,null!=(g=this.shortcuts)&&g.resetClass(),this.$shortcuts.on("dateselect",function(a,b){return h.setDate(b)})),d.datepickers.push(this)}return b.prototype._defaultFormat="YYYY-MM-DD",b.prototype._state=null,b.prototype.setOptionsFromDataAttr=function(){var a,b,c,d;this.$el.data(),c=this.$el.data(),d=[];for(a in c)b=c[a],d.push("date"===a.substr(0,4)?this.options[a]=b:void 0);return d},b.prototype.normalizeOptions=function(){var a,b,c,d,e;return(c=this.options).dateFormat||(c.dateFormat=this._defaultFormat),(d=this.options).allowClear||(d.allowClear=this.options.dateAllowClear),this.options.allowClear="yes"===(e=this.options.allowClear)||"true"===e||e===!0,b=this.options.dateMin,null==b||b instanceof Date?this.dateMin=b:(this.options.dateMin=this._parseDate(b),this.dateMin=this._parseDate(b)),a=this.options.dateMax,null==a||a instanceof Date?this.dateMax=a:(this.options.dateMax=this._parseDate(a),this.dateMax=this._parseDate(a))},b.prototype.setMinDate=function(a){return a instanceof Date||(a=this._parseDate(a)),this.dateMin=a,this.render()},b.prototype.clearMinDate=function(){return this.dateMin=null,this.render()},b.prototype.setMaxDate=function(a){return a instanceof Date||(a=this._parseDate(a)),this.dateMax=a,this.render()},b.prototype.clearMaxDate=function(){return this.dateMax=null,this.render()},b.prototype.render=function(){return this._updateMonthAndYear(),this._fill(),this.date&&this._updateSelection(),null!=this.shortcuts?(this.$datepicker.addClass("wdp-has-shortcuts"),this.$datepicker.find(".wdp-main").addClass("span7").removeClass("span12"),this.$shortcuts.insertBefore(this.$main)):(this.$datepicker.removeClass("wdp-has-shortcuts"),this.$datepicker.find(".wdp-main").addClass("span12").removeClass("span7"),this.$shortcuts.detach()),this},b.prototype._isShown=!1,b.prototype.hideInactive=function(){var a,b,c,e,f;for(e=d.datepickers,f=[],b=0,c=e.length;c>b;b++)a=e[b],a!==d.activeDatepicker&&f.push(a.hide());return f},b.prototype.show=function(){return this._isShown||this.$el.is(":not(:visible)")?void 0:(d.activeDatepicker=this,this.hideInactive(),this._isShown=!0,this.$calendar.show(),this.$datepicker.addClass("show"),this.height=this.$el.outerHeight(),this._place(),this.$window.on("resize",this._place),this.$document.on("click",this.hide))},b.prototype.hide=function(){return this._isShown?(this._isShown=!1,this.$calendarYear.hide(),this.$calendarMonth.hide(),this.$datepicker.removeClass("show"),this.$window.off("resize",this._place),this.$document.off("click",this.hide)):void 0},b.prototype.toggle=function(){return this._isShown?this.hide():this.show()},b.prototype.setDate=function(a,b){var e,f,g,h;return"string"==typeof a&&(a=d.DateUtils.parse(a,this.options.dateFormat).clone().toDate()),a instanceof Date?this._dateWithinRange(a)?(this.date=a,this._state.month=this.date.getMonth(),this._state.year=this.date.getFullYear(),this.options.allowClear&&null!=(h=this.$clearEl)&&h.show(),(null!=b?b.update:void 0)!==!1&&this.$el.val(this._formatDate(a)),(null!=b?b.silent:void 0)!==!0&&this.$el.trigger("change",[this.date,c.extend({silent:!0},b)]),this.options.hideOnSelect&&((null!=b?b.hide:void 0)||void 0===(null!=b?b.hide:void 0))?this.hide():void 0):void(null!=(g=this.$clearEl)&&g.hide()):void(this.options.allowClear&&(e=new Date,this._state.month=e.getMonth(),this._state.year=e.getFullYear(),null!=(f=this.$clearEl)&&f.hide()))},b.prototype.getDate=function(){return this.date},b.prototype.prev=function(){return 1===this._state.month?(this._state.month=12,this._state.year-=1):this._state.month-=1,this.render()},b.prototype.next=function(){return 12===this._state.month?(this._state.month=1,this._state.year+=1):this._state.month+=1,this.render()},b.prototype.destroy=function(){var a;return this.$datepicker.remove(),this.$el.removeData("datepicker"),d.datepickers=function(){var b,c,e,f;for(e=d.datepickers,f=[],b=0,c=e.length;c>b;b++)a=e[b],a!==this&&f.push(a);return f}.call(this)},b.prototype.setBaseDate=function(a){var b;return this.baseDate=null!=(b=this.shortcuts)?b.baseDate=a:void 0},b.prototype.getBaseDate=function(){return this.baseDate},b.prototype._initElements=function(){return this.options.className&&this.$el.addClass(this.options.className),this.$shortcuts=this.$datepicker.find(".wdp-shortcuts"),this.$main=this.$datepicker.find(".wdp-main"),this.$calendar=this.$main.find(".wdp-calendar"),this.$calendarTbody=this.$calendar.find("tbody"),this.$calendarYear=this.$datepicker.find(".wdp-year-calendar"),this.$calendarYearTbody=this.$calendarYear.find("tbody"),this.$calendarMonth=this.$datepicker.find(".wdp-month-calendar"),this.$calendarMonthTbody=this.$calendarMonth.find("tbody"),this.$monthAndYear=this.$calendar.find(".wdp-month-and-year"),this.$window=c(window),this.$document=c(document)},b.prototype._initPicker=function(){var a,b;return this.$datepicker=c(d.template),this.$datepicker.appendTo(document.body),b=moment.weekdaysMin||moment.langData()._weekdaysMin,a=b.join("</th><th>"),this.$datepicker.find("thead").append('<tr class="wdp-weekdays"><th>'+a+"</th></tr>")},b.prototype._initEvents=function(){var a,b,c,d,e=this;return this.$icon=this.$el.siblings(".add-on"),this.$icon.length>0||(this.$icon=null!=(b=this.$wrapper)?b.siblings(".add-on"):void 0),(null!=(c=this.$icon)?c.length:void 0)?(a=function(a){return e._cancelEvent(a),e._isShown&&e.$el.focus(),e.toggle()},this.$icon.on("click",a)):this.$el.on("focus click mousedown",this.show),this.$el.on("blur",this.hide),this.$el.on("change",this._updateFromInput),this.$el.on("change",this.render),this.$el.on("keydown",this._onInputKeydown),this.$el.on("click",this._cancelEvent),this.$datepicker.on("click",".js-wdp-calendar-cell:not(.wdp-disabled)",this._selectDate),this.$datepicker.on("click",".js-wdp-prev",this.prev),this.$datepicker.on("click",".js-wdp-next",this.next),this.$datepicker.on("click",this._cancelEvent),this.$datepicker.on("click",".js-wdp-set-month-year",this._showYearGrid),this.$datepicker.on("click",".js-wdp-year-calendar-cell",this._showMonthGrid),this.$datepicker.on("mousedown",this._cancelEvent),null!=(d=this.$clearEl)?d.on("click",this._clearInput):void 0},b.prototype._clearInput=function(){var a;return this.$el.val("").trigger("change"),null!=(a=this.$clearEl)?a.hide():void 0},b.prototype._updateFromInput=function(a,b,d){var e;return(e=this.$el.val())&&(this.date=this._parseDate(e)),this.options.allowClear?e||(this.date=null):this.date||(this.date=new Date),d=c.extend({silent:!0},d),this.setDate(this.date,d)},b.prototype._updateMonthAndYear=function(){var a,b;return a=new Date(this._state.year,this._state.month,1),b=moment(a).format("MMMM YYYY"),this.$monthAndYear.text(b)},b.prototype._formatDate=function(a){return d.DateUtils.format(a,this.options.dateFormat)},b.prototype._parseDate=function(a){var b,c;return(c=d.DateUtils.parse(a,this.options.dateFormat)).isValid()?(b=c.toDate(),0===b.getFullYear()&&b.setFullYear((new Date).getFullYear()),b):this.date},b.prototype._place=function(){var a,b,d,e,f;switch(f=parseInt(this.$el.parents().filter(function(){return"auto"!==c(this).css("z-index")}).first().css("z-index"),10)+10,d=this.$el.offset(),this.$el.data("position")){case"rightTop":e=d.top,b=d.left-this.$datepicker.outerWidth(),a="wpd-right-top";break;case"rightBottom":e=d.top-this.$datepicker.outerHeight()+this.$el.outerHeight(),b=d.left-this.$datepicker.outerWidth(),a="wpd-right-bottom";break;case"leftTop":e=d.top,b=d.left+this.$el.outerWidth(),a="wpd-left-top";break;case"leftBottom":e=d.top-this.$datepicker.outerHeight()+this.$el.outerHeight(),b=d.left+this.$el.outerWidth(),a="wpd-left-bottom";break;case"topRight":e=d.top+this.height,b=d.left-(this.$datepicker.outerWidth()-this.$el.outerWidth()),a="wpd-top-right";break;case"bottomLeft":e=d.top-this.$datepicker.outerHeight(),b=d.left,a="wpd-bottom-left";break;case"bottomRight":e=d.top-this.$datepicker.outerHeight(),b=d.left-(this.$datepicker.outerWidth()-this.$el.outerWidth()),a="wpd-bottom-right";break;default:e=d.top+this.height,b=d.left}return this.$datepicker.css({top:e,left:b,zIndex:f}),this.$datepicker.addClass(a)},b.prototype._showYearGrid=function(){var a,b,c,d,e;for(b=[],d=moment(new Date(this._state.year-9,0,1)),b.push('<tr class="wdp-calendar-row">'),c=e=1;20>=e;c=++e)a=d.year()===this._state.year?"wdp-selected":"",b.push('<td class="js-wdp-year-calendar-cell '+a+'" data-date="'+d.format("YYYY-MM-DD")+'">'+d.format("YYYY")+"</td>"),c%5===0&&(b.push("</tr>"),20!==c&&b.push('<tr class"wdp-calendar-row">')),d.add("years",1);return this.$calendarYearTbody.html(b.join("")),this.$calendar.hide(),this.$calendarYear.show()},b.prototype._showMonthGrid=function(a){var b,d,e,f,g,h;for(e=[],d=moment(this._parseDate(c(a.target).data("date"))),g=moment(new Date(d.year(),0,1)),e.push('<tr class="wdp-calendar-row">'),f=h=1;12>=h;f=++h)b=g.month()===this._state.month?"wdp-selected":"",e.push('<td class="js-wdp-calendar-cell '+b+'" data-date="'+g.format("YYYY-MM-DD")+'">'+g.format("MMM")+"</td>"),f%3===0&&(e.push("</tr>"),12!==f&&e.push('<tr class="wdp-calendar-row">')),g.add("months",1);return this.$calendarMonthTbody.html(e.join("")),this.$calendarYear.hide(),this.$calendarMonth.show()},b.prototype._fill=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(c=new Date(this._state.year,this._state.month,1),l=0,j=[],r=moment(c),d=r.daysInMonth(),q=r.clone().startOf("month"),e=r.clone().endOf("month"),f=q.day(),m=e.day(),o=0,0!==f)for(p=q.clone(),k=s=0,u=f-1;u>=0?u>=s:s>=u;k=u>=0?++s:--s)0===l++&&j.push('<tr class="wdp-calendar-row">'),b=p.add("days",-1).date(),a=new Date(this._state.year,this._state.month-1,b),i=this._formatDate(a),j[6-k+1]='<td class="wdp-calendar-othermonth js-wdp-calendar-cell '+this._getExtraClassNamesForDate(a)+'" data-date="'+i+'">'+b+"</td>",o++;for(a=new Date(this._state.year,this._state.month,1),k=t=1;d>=1?d>=t:t>=d;k=d>=1?++t:--t)a.setDate(k),g=this._formatDate(a),l++%7===0&&j.push('</tr><tr class="wdp-calendar-row">'),j.push('<td class="js-wdp-calendar-cell '+this._getExtraClassNamesForDate(a)+'" data-date="'+g+'">'+k+"</td>");for(n=e.clone();42>l;)b=n.add("days",1).date(),a=new Date(this._state.year,this._state.month+1,b),h=this._formatDate(a),l++%7===0&&j.push('</tr><tr class="wdp-calendar-row">'),j.push('<td class="wdp-calendar-othermonth js-wdp-calendar-cell '+this._getExtraClassNamesForDate(a)+'" data-date="'+h+'">'+b+"</td>");return j.push("</tr>"),this.$calendarYear.hide(),this.$calendarMonth.hide(),this.$calendarTbody.html(j.join("")),this.$calendar.show()},b.prototype._cancelEvent=function(a){return a.stopPropagation(),a.preventDefault()},b.prototype._onInputKeydown=function(a){var b,c,e,f,g,h;if(!a.metaKey){switch(a.keyCode){case d.Keys.DOWN:case d.Keys.J:this._isShown&&(this._cancelEvent(a),c=null!=(f=this.shortcuts)?f.selectNext:void 0,e=7),this.show();break;case d.Keys.RETURN:this._isShown?this.hide():this.show();break;case d.Keys.UP:case d.Keys.K:this._isShown&&(this._cancelEvent(a),c=null!=(g=this.shortcuts)?g.selectPrev:void 0,e=-7);break;case d.Keys.LEFT:case d.Keys.H:this._isShown&&(this._cancelEvent(a),e=-1);break;case d.Keys.RIGHT:case d.Keys.L:this._isShown&&(this._cancelEvent(a),e=1);break;case d.Keys.ESC:case d.Keys.TAB:this.hide()}return a.shiftKey?"function"==typeof c?c():void 0:null!=e?(b=new Date(this.date.getFullYear(),this.date.getMonth(),this.date.getDate()+e),null!=(h=this.shortcuts)&&h.resetClass(),this.setDate(b,{hide:!1})):void 0}},b.prototype._updateSelection=function(){var a;return a=this._formatDate(this.date),this.$calendarTbody.find(".wdp-selected").removeClass("wdp-selected"),this.$calendarTbody.find("td[data-date='"+a+"']").addClass("wdp-selected")},b.prototype._selectDate=function(a){var b,d;return this.$calendarMonth.hide(),this.$calendar.show(),null!=(d=this.shortcuts)&&d.resetClass(),b=this._parseDate(c(a.target).data("date")),this.$el.trigger("shortcutclear"),this.setDate(b)},b.prototype._dateWithinRange=function(a){return this.dateMin&&a.valueOf()<this.dateMin.valueOf()?!1:this.dateMax&&a.valueOf()>this.dateMax.valueOf()?!1:!0},b.prototype._getExtraClassNamesForDate=function(a){var b;return b=[],this._dateWithinRange(a)||b.push("wdp-disabled"),b.join(" ")},b}(),e=c.fn.datepicker,d.init=function(){var a,e,f;return e=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],null==e&&(e={}),"string"==typeof e&&"_"!==e[0]&&"render"!==e?(f=c(this).data("datepicker"),null!=f?f[e].apply(f,a):void 0):this.each(function(){var a;return a=c(this),f=a.data("datepicker"),c.extend(e,{el:this}),f?void 0:a.data("datepicker",f=new d.WaveDatepicker(e).render())})},c.fn.datepicker=d.init,d.noConflict=function(){return c.fn.datepicker=e},d})}).call(this);